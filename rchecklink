#!/bin/bash
set -o errexit
set -o nounset

# Reverse-checklink.

# Perl script checklink (W3C® Link Checker) controleert of links geldig zijn,
# d.i. of iedere link gevolgd kan worden/er een bestand aanwezig is.
# Dit Bash script doet het omgekeerde: worden alle bestanden gebruikt?

readonly dir1=/home/karel/kz-uploads/app/data
readonly dir2=/home/karel/kz-uploads/dist/data
readonly html=/home/karel/kz-uploads/dist/html

declare -i todo=0
declare -i skip=0
declare -i fine=0
declare -i total=0

printf '%s\n' 'Bestanden niet in gebruik:'
while read -r file; do
    ((++total))
    if ! grep -r "$(basename "$file")" $html &> /dev/null; then
        case $file in
            *-pc0*|*-pc-*|*debian.sh*|*debian-user.sh*|*kz-vm-hugowin732*)
                ((++skip))
                continue
                ;;
            *home/LF*)
                ((++skip))
                continue
                ;;
        esac
        ((++todo))
        printf '%s\n' "rm $file"
    else
        ((++fine))
    fi
done < <(find $dir1 $dir2 -type f -print | sort)
printf '%s\n' "
$total bestanden gevonden, $todo niet in gebruik, $fine in gebruik, \
$skip overgeslagen (computer-specifieke bestanden)

Neem deze bestanden na onderzoek op in html gevolgd door:
- kz build
- kz deploy
of deze bestanden verwijderen uit:
- $dir1/
- $dir2/
gebruik hiervoor:
- sudo updatedb
- locate <file>
- rm <file>

Verschillen tussen app/ en dist/ (linux, icaclient, en kz is oké):"
diff --recursive /home/karel/kz-uploads/app/ /home/karel/kz-uploads/dist/ ||
    true
if ! command -v checklink 1> /dev/null; then
    printf '%s\n' 'Installeer checklink...'
    sudo apt-get install --yes w3c-linkchecker
fi
printf '%s\n' "
Perl script checklink (W3C® Link Checker) controleert of links geldig zijn.
Controleer de geldigheid van links 'linux.html':"
checklink   --broken                                \
            --summary                               \
            --suppress-broken                       \
            -1:"https://jigsaw.w3.org/css-validator/validator?uri=karelzimmer.\
nl%2Fcss%2Fstijlblad.css"                           \
            --suppress-broken                       \
            -1:"https://validator.w3.org/check?uri=http%3A%2F%2Fkarelzimmer.nl\
%2Fhtml%2Fcontact.html"                             \
            https://karelzimmer.nl/html/linux.html  2> /dev/null
