#!/bin/bash
###############################################################################
# Split checksum files.
#
# This script creates an .iso.txt with the checksum for an .iso.
#
# Written by Karel Zimmer <info@karelzimmer.nl>, CC0 1.0 Universal
# <https://creativecommons.org/publicdomain/zero/1.0>, 2021-2023.
###############################################################################

###############################################################################
# Constants
###############################################################################

SEARCHDIR=$HOME/Downloads

###############################################################################
# Variables
###############################################################################

iso=''

###############################################################################
# Script
###############################################################################

cd "$SEARCHDIR" || exit 1

for iso in *.iso; do

    # shellcheck disable=SC2062
    grep    --word-regexp           \
            --regexp=" $iso"        \
            --regexp=' *'"$iso"     \
            --exclude=*.iso         \
            --exclude="$iso".txt    \
            --exclude-dir=*         \
            --no-filename           \
            --max-count=1           \
            -- *.txt                > "$iso".txt || grep_rc=$?
    if [[ $grep_rc -ne 0 ]]; then
        printf '%s\n' "No checksum found for $iso." >&2
    else
        printf '%s\n' "Checksum file $iso.txt created."
    fi

done

printf '\n%s\n%s\n' 'To check the image files (.iso) execute:'  \
"cd $SEARCHDIR; sha256sum --check *.iso.txt 2>/dev/null; sha512sum --check \
*.iso.txt 2>/dev/null; cd - 1>/dev/null"
